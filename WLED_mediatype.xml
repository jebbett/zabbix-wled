<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.0</version>
    <date>2022-01-03T14:06:49Z</date>
    <media_types>
        <media_type>
            <name>WLED</name>
            <type>WEBHOOK</type>
            <parameters>
                <parameter>
                    <name>ColourAverage</name>
                    <value>0,255,0</value>
                </parameter>
                <parameter>
                    <name>ColourDisaster</name>
                    <value>255,0,0</value>
                </parameter>
                <parameter>
                    <name>ColourHigh</name>
                    <value>255,89,0</value>
                </parameter>
                <parameter>
                    <name>ColourInformation</name>
                    <value>0,0,255</value>
                </parameter>
                <parameter>
                    <name>ColourNotClassified</name>
                    <value>255,255,255</value>
                </parameter>
                <parameter>
                    <name>ColourWarning</name>
                    <value>255,255,0</value>
                </parameter>
                <parameter>
                    <name>DefaultColour</name>
                    <value>0,0,0</value>
                </parameter>
                <parameter>
                    <name>event_severity</name>
                    <value>{EVENT.SEVERITY}</value>
                </parameter>
                <parameter>
                    <name>event_value</name>
                    <value>{EVENT.VALUE}</value>
                </parameter>
                <parameter>
                    <name>HostsList</name>
                    <value>'SERVER1','SERVER2','SERVER2'</value>
                </parameter>
                <parameter>
                    <name>host_name</name>
                    <value>{HOST.NAME}</value>
                </parameter>
                <parameter>
                    <name>IPAddress</name>
                    <value>192.168.1.123</value>
                </parameter>
                <parameter>
                    <name>LEDRanges</name>
                    <value>[8,18],[26,29],[48,51]</value>
                </parameter>
            </parameters>
            <script>try {&#13;
    var params = JSON.parse(value);&#13;
    &#13;
    switch(params.event_severity) {&#13;
      case 'Not classified':&#13;
        colour = eval('[' + params.ColourNotClassified + ']');&#13;
        break;&#13;
      case 'Information':&#13;
        colour = eval('[' + params.ColourInformation + ']'); &#13;
        break;&#13;
      case 'Warning':&#13;
        colour = eval('[' + params.ColourWarning + ']'); &#13;
        break;&#13;
      case 'Average':&#13;
        colour = eval('[' + params.ColourAverage + ']'); &#13;
        break;&#13;
      case 'High':&#13;
        colour = eval('[' + params.ColourHigh + ']'); &#13;
        break;&#13;
      case 'Disaster':&#13;
        colour = eval('[' + params.ColourDisaster + ']'); &#13;
        break;&#13;
    }    &#13;
    &#13;
var defcol = eval('[' + params.DefaultColour + ']'); &#13;
var ranges = eval('[' + params.LEDRanges + ']');&#13;
var hosts = eval('[' + params.HostsList + ']');&#13;
&#13;
hosts.forEach(function (value, i) {&#13;
    if (value == params.host_name){ &#13;
        if (params.event_value == 0) { setColour = defcol; } else { setColour = colour; }&#13;
&#13;
        wstart = ranges[i][0]-1;&#13;
        wend = ranges[i][1];&#13;
    &#13;
        var wledparams = {&#13;
            &quot;seg&quot;:{&#13;
                &quot;i&quot;:[wstart, wend, setColour ]&#13;
            }&#13;
        },&#13;
        data,&#13;
        response,&#13;
        request = new CurlHttpRequest(),&#13;
        url = 'http://' + params.IPAddress + '/json/state/';&#13;
        //url = 'https://webhook.site/948de8ee-afea-4fa5-bcaf-bc7cb6f37d7f/';&#13;
&#13;
        request.AddHeader('Content-Type: application/json');&#13;
        data = JSON.stringify(wledparams);&#13;
&#13;
        // Log file.&#13;
        Zabbix.Log(4, '[WLED Webhook] params: ' + data);&#13;
        response = request.Post(url, data);&#13;
        Zabbix.Log(4, '[WLED Webhook] HTTP code: ' + request.Status());&#13;
    }&#13;
});&#13;
    return 'OK';&#13;
}&#13;
catch (error) {&#13;
    Zabbix.Log(4, '[WLED Webhook] notification failed: ' + error);&#13;
    throw 'Sending failed: ' + error + '.';&#13;
}</script>
            <timeout>10s</timeout>
            <description>https://github.com/jebbett/zabbix-wled/&#13;
&#13;
IMPORTANT: EVERYTHING IS CASE SENSITIVE, you must complete steps 1-3 below.&#13;
&#13;
1. Set &quot;IPAddress&quot; above to your WLED strip, WLED should be updated to the latest version.&#13;
EXAMPLE: 192.168.1.123&#13;
2. Update &quot;HostsList&quot; with your servers host name as specified in Zabbix, if you need to allocate two sections of the strip to 1 server (i.e. both sides of the rack) then list the server twice.&#13;
EXAMPLE: 'Server1','Server2','Server2'&#13;
3. Update &quot;LEDRanges&quot; for each of the hosts mentioned above, the first LED is LED 1, each host entry requires a start and an end LED number. [Start,End]&#13;
EXAMPLE: [8,18],[26,29],[48,51]&#13;
4. Set custom colours if you require, colours are in standard RGB format&#13;
5. The &quot;DefaultColour&quot; is set when an item is reported as &quot;recovering&quot; (NOTE: event_value = 1 for problem, 0 for recovering)&#13;
&#13;
Example how to use this Media Type:&#13;
1. Add the media type to your user (Administration &gt; Media Users &gt; [User] &gt; Media)&#13;
2. Enable an action to trigger events i.e. enable Configuration &gt; Actions &gt;  &quot;Report problems to Zabbix administrators&quot; with an operation type of &quot;Send Message&quot; and for &quot;Recovery operations&quot; you can use &quot;Notify all involved&quot;&#13;
&#13;
Limitations:&#13;
1. This only outputs to the first segment of an LED strip (if you are using a segments in WLED)&#13;
2. It does not retain alerts if WLED triggers a different effect.&#13;
3. If a host has two alerts then only the latest alert will be represented &#13;
</description>
            <message_templates>
                <message_template>
                    <event_source>TRIGGERS</event_source>
                    <operation_mode>PROBLEM</operation_mode>
                    <subject>Problem: {EVENT.NAME}</subject>
                    <message>Problem started at {EVENT.TIME} on {EVENT.DATE}&#13;
Problem name: {EVENT.NAME}&#13;
Host: {HOST.NAME}&#13;
Severity: {EVENT.SEVERITY}&#13;
Operational data: {EVENT.OPDATA}&#13;
Original problem ID: {EVENT.ID}&#13;
{TRIGGER.URL}</message>
                </message_template>
                <message_template>
                    <event_source>TRIGGERS</event_source>
                    <operation_mode>RECOVERY</operation_mode>
                    <subject>Resolved in {EVENT.DURATION}: {EVENT.NAME}</subject>
                    <message>Problem has been resolved in {EVENT.DURATION} at {EVENT.RECOVERY.TIME} on {EVENT.RECOVERY.DATE}&#13;
Problem name: {EVENT.NAME}&#13;
Host: {HOST.NAME}&#13;
Severity: {EVENT.SEVERITY}&#13;
Original problem ID: {EVENT.ID}&#13;
{TRIGGER.URL}</message>
                </message_template>
                <message_template>
                    <event_source>TRIGGERS</event_source>
                    <operation_mode>UPDATE</operation_mode>
                    <subject>Updated problem: {EVENT.NAME}</subject>
                    <message>{USER.FULLNAME} {EVENT.UPDATE.ACTION} problem at {EVENT.UPDATE.DATE} {EVENT.UPDATE.TIME}.&#13;
{EVENT.UPDATE.MESSAGE}&#13;
&#13;
Current problem status is {EVENT.STATUS}, acknowledged: {EVENT.ACK.STATUS}.</message>
                </message_template>
                <message_template>
                    <event_source>DISCOVERY</event_source>
                    <operation_mode>PROBLEM</operation_mode>
                    <subject>Discovery: {DISCOVERY.DEVICE.STATUS} {DISCOVERY.DEVICE.IPADDRESS}</subject>
                    <message>Discovery rule: {DISCOVERY.RULE.NAME}&#13;
&#13;
Device IP: {DISCOVERY.DEVICE.IPADDRESS}&#13;
Device DNS: {DISCOVERY.DEVICE.DNS}&#13;
Device status: {DISCOVERY.DEVICE.STATUS}&#13;
Device uptime: {DISCOVERY.DEVICE.UPTIME}&#13;
&#13;
Device service name: {DISCOVERY.SERVICE.NAME}&#13;
Device service port: {DISCOVERY.SERVICE.PORT}&#13;
Device service status: {DISCOVERY.SERVICE.STATUS}&#13;
Device service uptime: {DISCOVERY.SERVICE.UPTIME}</message>
                </message_template>
                <message_template>
                    <event_source>AUTOREGISTRATION</event_source>
                    <operation_mode>PROBLEM</operation_mode>
                    <subject>Autoregistration: {HOST.HOST}</subject>
                    <message>Host name: {HOST.HOST}&#13;
Host IP: {HOST.IP}&#13;
Agent port: {HOST.PORT}</message>
                </message_template>
            </message_templates>
        </media_type>
    </media_types>
</zabbix_export>
